FROM grafana/agent:v0.32.0

# Put default config somewhere safe inside image
COPY agent-config.river /opt/agent/default_config.river

# Create WAL directory with permissions
RUN mkdir -p /tmp/agent/wal && chmod 0775 /tmp/agent/wal

# Copy entrypoint script
COPY entrypoint.sh /opt/agent/entrypoint.sh
RUN chmod +x /opt/agent/entrypoint.sh

# Set entrypoint
ENTRYPOINT ["/opt/agent/entrypoint.sh"]

# DO NOT set CMD
